{namespace terfe2=Tx_TerFe2_ViewHelpers}

<f:layout name="Default" />

<f:section name="main">

	<h2><f:translate key="single_extension"/></h2>

	<!-- Extension details -->
	<div class="extension">

		<!-- Headline -->
		<div class="extension-head">
			<h4>
				<span class="extension-icon"><terfe2:extensionIcon version="{extension.lastVersion}" alt="{extension.lastVersion.title}" /></span>
				<f:link.action controller="Extension" action="show" arguments="{extension : extension}" class="extension-row-toggle">{extension.lastVersion.title}</f:link.action>
				<span class="extension-date"><f:translate key="version"/> {extension.lastVersion.versionString} - <terfe2:dateTime format="{settings.dateFormat}">{extension.lastVersion.uploadDate}</terfe2:dateTime> | <strong><terfe2:format content="{extension.lastVersion.state}" function="ucfirst" /></strong></span>
			</h4>
		</div>

		<!-- Content area -->
		<div class="extension-regular">

			<!-- Description -->
			<div class="extension-description">
				<p>{extension.lastVersion.description}</p>
			</div>

			<!-- General information -->
			<div class="extension-info">
				<table>
					<tr>
						<td class="extension-label"><f:translate key="extension"/>:</td>
						<td>{extension.extKey}</td>
					</tr>
					<tr>
						<td class="extension-label"><f:translate key="author"/>:</td>
						<td><f:link.action controller="Author" action="show" arguments="{author : extension.lastVersion.author}">{extension.lastVersion.author.name}</f:link.action></td>
					</tr>
					<tr>
						<td class="extension-label"><f:translate key="category"/>:</td>
						<td><f:render partial="InlineCategoryList" arguments="{categories: extension.categories}"/></td>
					</tr>
					<tr>
						<td class="extension-label"><f:translate key="votes"/>:</td>
						<td><span class="extension-plus">+&nbsp;{extension.votes.positive}</span>&nbsp;&nbsp;|&nbsp;&nbsp;<span class="extension-minus">-&nbsp;{extension.votes.negative}</span></td>
					</tr>
				</table>
			</div>

			<div class="extension-additional">

				<!-- Additional description -->
				<div class="extension-description">

					<!-- Images and other media -->
					<div class="extension-images">
						<f:if condition="{extension.lastVersion.media}">
							<f:for each="{extension.lastVersion.media}" as="media">
								<f:if condition="{media.type} == 0">
									<f:then>
										<!-- add shadowbox effect to images -->
										<a href="{settings.mediaRootPath}{extension.extKey}/{media.source}" rel="shadowbox[{extension.extKey}]">
											<f:image src="{settings.mediaRootPath}{extension.extKey}/{media.source}" width="150" maxHeight="120" alt="{media.title}" />
										</a>
									</f:then>
									<f:else>
										other medias are not yet implemented !!
									</f:else>
								</f:if>
							</f:for>
						</f:if>
					</div>

				</div>

				<!-- Additional information -->
				<div class="extension-info">
					<table>
						<tr>
							<td class="extension-label"><f:translate key="relations"/>:</td>
							<td><f:render partial="InlineRelationList" arguments="{relations: extension.lastVersion.filteredSoftwareRelations}"/></td>
						</tr>
						<!-- <tr>
							<td class="extension-label"><f:translate key="reverse_relations"/>:</td>
							<td>TODO: Related to this</td>
						</tr> -->
						<tr>
							<td class="extension-label"><f:translate key="manual"/>:</td>
							<td>TODO: Manual link</td>
						</tr>
						<tr>
							<td colspan="2"><f:translate key="downloads_by_version"/>:<terfe2:chart object="{extension}" method="downloadsByVersion" height="120" width="200" renderOnLoad="1" /></td>
						</tr>
					</table>
				</div>

			</div>
			<br class="tx_terfe2-clear" />

			<!-- adding tabs for the other informations like changelog, files, etc. -->
			<div class="b-tabs">
		<ul class="tabs orange-tabs">
			<li>
				<a href="#tx_terfe2_tab_uploadcomments"><f:translate key="upload_comment"/></a>
			</li>
			<li>
				<a href="#tx_terfe2_tab_versionhistory"><f:translate key="version_history"/></a>
			</li>
			<li>
				<a href="#tx_terfe2_tab_changelog"><f:translate key="changelog"/></a>
			</li>
		</ul>
		<div class="tab-panes">
			<div class="csc-default show-tab" id="tx_terfe2_tab_uploadcomments">
				<div class="tab-content ">
					<p>{extension.lastVersion.uploadComment}</p>
				</div>
			</div>
			<div class="csc-default show-tab" id="tx_terfe2_tab_versionhistory">
				<div class="tab-content ">
					<f:for each="{extension.versions}" as="version">
						<p>
							<f:translate key="version" /> {version.versionString} - <terfe2:dateTime format="{settings.dateFormat}">{version.uploadDate}</terfe2:dateTime><br />
							{version.uploadComment}
						</p>
					</f:for>
				</div>
			</div>
			<div class="csc-default show-tab" id="tx_terfe2_tab_changelog">
				<div class="tab-content ">
					<p>TODO: Changelog from file</p>
				</div>
			</div>
		</div>
	</div>

		</div>

		<f:link.action controller="Extension" action="edit" arguments="{extension : extension}"><f:translate key="edit"/></f:link.action>
	</div>
</f:section>