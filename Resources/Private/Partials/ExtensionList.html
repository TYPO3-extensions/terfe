{namespace terfe2=Tx_TerFe2_ViewHelpers}
{namespace p=Tx_Paginate_ViewHelpers}

<f:if condition="{extensions}">
	<f:then>
		<p:widget.paginate objects="{extensions}" as="paginateExtensions" configuration="{margin: 2, itemsPerPage: settings.listCount, insertAbove: 1, insertBelow: 1}">
			<f:for each="{paginateExtensions}" as="extension">
				<div class="ter-ext-list-row">

					<!-- Headline -->
					<div class="ter-ext-list-row-head">
						<span class="ter-ext-list-row-icon"><terfe2:extensionIcon version="{extension.lastVersion}" alt="{extension.lastVersion.title}" /></span>
						<f:link.action controller="Extension" action="show" arguments="{extension : extension}" class="ter-toggle">{extension.lastVersion.title}</f:link.action>
						<span class="ter-ext-list-row-state ter-ext-list-row-state-{extension.lastVersion.state}">{extension.lastVersion.state}</span>
					</div>

					<!-- Content area -->
					<div class="ter-ext-list-row-regular">

						<!-- Description -->
						<div class="ter-ext-list-row-description">
							<p><terfe2:crop length="{settings.descriptionLength}">{extension.lastVersion.description}</terfe2:crop></p>
						</div>

						<!-- General information -->
						<div class="ter-ext-list-row-info">
							<table>
								<tr>
									<td class="ter-ext-list-row-label"><f:translate key="extensionKey"/></td>
									<td>{extension.extKey}</td>
								</tr>
								<tr>
									<td class="ter-ext-list-row-label"><f:translate key="author"/></td>
									<td><f:link.action controller="Author" action="show" arguments="{author : extension.lastVersion.author}">{extension.lastVersion.author.name}</f:link.action></td>
								</tr>
								<tr>
									<td class="ter-ext-list-row-label"><f:translate key="category"/></td>
									<td><f:render partial="InlineCategoryList" arguments="{categories: extension.categories}"/></td>
								</tr>
								<!-- <tr>
									<td class="ter-ext-list-row-label"><f:translate key="votes"/></td>
									<td><span class="ter-ext-list-row-plus">+&nbsp;{extension.votes.positive}</span>&nbsp;&nbsp;|&nbsp;&nbsp;<span class="ter-ext-list-row-minus">-&nbsp;{extension.votes.negative}</span></td>
								</tr> -->
								<!-- Additional information -->
								<tr class="ter-toggle-show">
									<td class="ter-ext-list-row-label"><f:translate key="relations"/>:</td>
									<td><f:render partial="InlineRelationList" arguments="{relations: extension.lastVersion.filteredSoftwareRelations}"/></td>
								</tr class="ter-toggle-show">
								<!-- <tr>
									<td class="ter-ext-list-row-label"><f:translate key="reverse_relations"/>:</td>
									<td>TODO: Related to this</td>
								</tr> -->
								<tr class="ter-toggle-show">
									<td class="ter-ext-list-row-label"><f:translate key="manual"/>:</td>
									<td><terfe2:documentationLink>{extension.lastVersion}</terfe2:documentationLink></td>
								</tr>
								<!-- <tr>
									<td class="ter-ext-list-row-label"><f:translate key="tags"/>:</td>
									<td><f:render partial="InlineTagList" arguments="{tags: extension.tags}"/></td>
								</tr> -->
								<tr class="ter-toggle-show">
									<td colspan="2"><f:translate key="downloads_by_version"/>:<terfe2:chart object="{extension}" method="downloadsByVersion" height="120" width="200" renderOnLoad="0" /></td>
								</tr>
							</table>
						</div>

					</div>
					<div class="ter-ext-list-row-additional ter-toggle-show">

						<!-- Additional description -->
						<div class="ter-ext-list-row-description">

							<!-- Images and other media -->
							<div class="ter-ext-list-row-images">
								<f:if condition="{extension.lastVersion.media}">
									<f:for each="{extension.lastVersion.media}" as="media">
										<!-- display only images in the list view -->
										<f:if condition="{media.type} == 0">
											<!-- add shadowbox effect to images -->
											<a href="{settings.mediaRootPath}{extension.extKey}/{media.source}" rel="shadowbox[{extension.extKey}]">
												<f:image src="{settings.mediaRootPath}{extension.extKey}/{media.source}" width="150" maxHeight="120" alt="{media.title}" />
											</a>
										</f:if>
									</f:for>
								</f:if>
							</div>

							<!-- Comments / changelog -->
							<f:if condition="{extension.lastVersion.uploadComment}">
							<div class="ter-ext-list-lastUploadComment">
								<h4><f:translate key="last_upload_comment"/></h4>
								<p>{extension.lastVersion.uploadComment}</p>
							</div>
							</f:if>

							<div class="bu bu-mini">
								<f:link.action action="show" arguments="{extension: extension}"><f:translate key="link.extension_details" /></f:link.action>
							</div>

						</div>
						<br class="tx_terfe2-clear" />

					</div>
					<br class="tx_terfe2-clear" />

					<div class="ter-ext-list-row-details ter-toggle">
						<span><f:translate key="expand_details"/></span>
						<hr />
					</div>

					<div class="ter-ext-list-row-meta">
						<f:translate key="version"/>: <b>{extension.lastVersion.versionString}</b><f:translate key="upload_date"/>: <b><terfe2:dateTime format="{settings.dateFormat}"> {extension.lastVersion.uploadDate}</terfe2:dateTime></b><f:translate key="downloads"/>: <b>{extension.allDownloads}</b>
					</div>

					<div class="ter-ext-list-row-buttons">
						<span class="bu bu-mini"><f:link.action controller="Extension" action="download" arguments="{version : extension.lastVersion}"><f:translate key="download_t3x"/></f:link.action></span>
						<f:if condition="{extension.lastVersion.mediaCreated}">
							<span class="bu bu-mini"><f:link.action controller="Extension" action="download" arguments="{version : extension.lastVersion, format : 'zip'}"><f:translate key="download_zip"/></f:link.action></span>
						</f:if>
					</div>
					<br class="tx_terfe2-clear" />
				</div>
			</f:for>
		</p:widget.paginate>
	</f:then>
	<f:else>
		<f:translate key="msg.no_entries_found" />
	</f:else>
</f:if>